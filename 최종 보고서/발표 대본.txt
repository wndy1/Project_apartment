# 데이터마이닝 발표 대본
# 10분 발표

#1 표지
안녕하십니까 7조 피티 발표 맡은 정동호입니다.
저희 주제는 제목과 같이 인천광역시 아파트 제곱미터당 평균 매매 가격의 분석과 예측입니다.

#2 목차
목차는 다음과 같습니다.

#3 서론, 주제 및 선정 이유
앞서 말씀드린 것 처럼 저희는 인천아파트 집값 분석과 예측이고
지난 3년에 거래된 아파트 제곱미터당 평균 매매가를 기준으로 잡았습니다.
이 주제를 선정한 이유는 집값을 잡으려는 부동산정책에도 불구하고 증가하는 아파트 가격 요인이 무엇인지?
다양한 변수들에 대한 인천아파트 집값을 분석함으로써 실제 동향에 대한 인사이트를 얻고자 했습니다.

#4 서론, 분석방법
분석방법은 EDA, 의사결정학습법, 회귀분석을 사용했습니다.

#5 Data Handling, 데이터 조사
다양한 변수를 조사하고 데이터를 얻기 위해 여러 공공사이트를 참고했습니다.

#6 Data Handling, 변수 설명
종속 변수는 지난 16년 1월 부터 18년 12월 간 거래된 표본 인천아파트 평균 매매 가격이고

#7, 8 Data Handling 변수 설명
저희 조는 독립변수를 내부적 외부적 요인으로 구분했습니다.
내부적요인은 주로 아파트의 직접 연관된 요인이고
외부적요인은 그외 아파트에 영향을 줄 수 있는 요인들입니다.

#9,10,11,12  Data Handling 주요 변수 설명
저희가 생각한 주요변수는 다음과 같고
일반적으로 영향을 줄거란 생각되는 변수들이기에 설명은 보면 이해가 빠를 것 같습니다.

#13 EDA, A)인천광역시 아파트 제곱미터당 평균 매매 가격 변동
저희가 조사한 변수에 대한 EDA가 많기 때문에 간단히 3가지를 소개하겠습니다.
먼저 인천광역시 아파트 제곱미터당 평균 매매 가격 변동입니다.
앞서 종속변수인 인천 아파트 평균 매매 가격과 혼동이 될 수 있는데, 이 변수는
16년 1월부터 18년 12월 간 거래된 총 인천 광역시 아파트 평균 매매 가격입니다.
시계열 그래프를 보시면, 꾸준히 상승세를 보이고 있고 16년 1월에 비해 18년 12월에는
제곱미터당 약 25만원 정도 상승했다는 것을 알 수 있습니다. 그래서 향후 어떻게 변화할지에 대해
시계열 분석을 진행했습니다.

# 14 EDA, A)인천광역시 아파트 제곱미터당 평균 매매 가격 변동 
정상성을 판단을 위해 ACF, PACF 플롯를 그렸고, ACF 플롯에서 정상성을 만족하지 않아
1차 차분을 진행했습니다.

#15 EDA, A)인천광역시 아파트 제곱미터당 평균 매매 가격 변동
1차 차분 진행 후 다시 ACF, PACF 플롯을 보면, 정상성을 만족한다고 볼 수 있고
ACF의 경우, lag 3이후 절단값을 보이기에 MA(3)이라 생각할 수 있고
PACF의 경우, lag 2이후 절단값을 보이기에 AR(2)로 판단할 수 있습니다.
최종적으로 예측한 시계열 모형은 ARIMA(2,1,3)입니다.

#16, A)인천광역시 아파트 제곱미터당 평균 매매 가격 변동
결론은 계속 상승세를 보이고, 실제 19년 3월 데이터 비교를 해보면 어느정도 비슷하다는 것을 확인할 수 있습니다.

#17, B) 인천광역시 구군별 제곱미터당 평균 매매 가격 변화
앞서서는 전체적인 관점이였으면 이후 소개할 두개의 EDA는 세부적인 사항입니다.
먼저 구군별 입니다.
첫번째 그래프를 보면 모든 구군에서 증가했다는 것을 확인할 수 있고
두번째 그래프에서는 압도적으로 연수구가 가장 높은 가격대를 형성하고 있고
반대로는 강화군이 제일 낮습니다. 연수구가 높은 이유는 송도 국제도시가 있기 때문이라 유추할 수 있습니다.

#18, C) 인천광역시 거래규모별 제곱미터당 평균 매매 가격 변동
마지막으로는 거래규모별 입니다.
여기서 거래규모별은 아파트 평수에 따른 차이라 생각하면 됩니다.
추세를 보면 집값은 상승했다는 것을 확인할 수 있고
여기서 중요한 점은 가장 높은 가격대를 형성하는 규모가 큰 평수가 아니라는 점입니다.
무조건 평수가 크다고 해서 제일 높은 가격대를 형성하는 것은 아니고 오히려 중간 규모, 예를 들면
살기 적당한 규모가 더 높다고 볼 수 있습니다.
이렇게 해서 EDA를 통해 변수들에 대해 다양한 인사이트를 얻을 수 있었습니다.

#19 Modeling 1) Data set 구분
EDA 이후 저희는 모델링을 하기 위해 2985개의 데이터 셋을 4대3대3으로 Training set, validation set, test set으로 구분했습니다.
데이터 셋은 종속변수1개와 독립변수 15개로 이루어졌습니다.
저희 조는 모델링 기법으로 의사결정트리와 회귀분석을 이용했습니다.

#20 의사결정 트리
의사결졍학습법에서 training set을 이용해 학습하고 pruning을 통해 최종 모형을 선택했습니다.
저희는 R package의 rpart package를 이용해 학습했습니다.
종속변수가 연속형이기에 회귀 의사결정트리로 학습했습니다.
초기 모형은 다음과 같이 8개의 터미널 노드를 가진 모형이고
분기 기준이 된 변수는 평균전세가, 교육시설수, 노후도 세가지입니다.

#21 pruning
pruning을 위해 다음의 플롯을 통해 오분률이 최소인 지점의 터미널 노드수를 가지는 모형을 최종모형으로 선택할려고 했습니다.
하지만 오분률은 터미널 노드수가 많을수록 계속 하락세를 보이기에 어느 수준의 터미널 노드를 결정해야할지 고민을 했습니다 

#22 MSE 비교
그래서 minsplit 변화에 따른 training MSE와 validaiotn MSE 추이를 그래프로 표현해서 적절한 터미널 노드수를 결정하고자 했습니다.
여기서 minsplit은 분기에 필요한 최소데이터 수를 의미합니다. minsplit이 많다는 것은 터미널노드수가 적다는 것이고 반대로는 많다는 것을 의미합니다.

#23 MSE 비교
그래서 흐름상 minsplit이 125일 때 터미널 노드수를 가지는 모형을 선택하게 되었습니다.
minsplit 125이면 터미널노드수가 15개인 모형입니다.
#24 최종모형
최종모형은 다음과 같이 15개인 모형입니다.

#25 최종모형
최종모형의 각 MSE 비교와 어떤 변수가 분기시 많이 사용됬는지 관련 표입니다.
먼저 MSE의 경우 Test MSE가 가장 낮다는 것을 확인할 수 있습니다.
그리고 인천아파트 평균매매가에 가장 영향을 주는 변수가 평균전세가이고 그 다음은 노후도입니다.
모두 아파트와 관련된 내부변수가 인천아파트 평균매매가 형성에 많은 영향을 준다고 판단할 수 있습니다.

#26 회귀분석
그 다음은 회귀분석입니다.
저희 초기모형은 다음과 같습니다. 독립변수는 15개입니다.

#27 잔차플롯
초기모형에 대한 잔차 진단을 통해 정규성, 독립성, 선형성, 등분산성 확인을 했고,
앞서 EDA에서 연수구의 경우 높은 집값 가격대를 형성했는데 여기에 따로 떨어진 분포가
연수구중에서도 송도동 데이터임을 짐작할 수 있습니다.

#28 다중공선성 확인
종속변수가 아닌 독립변수간 높은 상관관계는 모형의 불안전성을 높이기 때문에 다중 공선성 검사를 했고
평균인구수와 평균세대수에서 공선성이 존재하는 것을 확인했습니다.

#29 변수선택법
저희는 stepwise 변수 선택법을 이용했고 평균인구수와 평균세대수 공선성을 고려하여 최종모형을 선택하고자 했습니다.

#30 최종모형 선택과정
최종모형 선택에 있어 모든 케이스를 고려했습니다. 초기모형부터 평균세대수제거 시 stepwise적용한 모형까지
각각 Train MSE와 validation MSE 변화를 확인했습니다.
먼저 공선성 해결을 위해 평균인구수와 평균세대수 둘중 하나의 제거에 따른 변화를 봐서 어느 모형이 MSE가 낮은지 비교했습니다.
그 결과 마지막 평균세대수 제거한 stepwise 적용 모형을 최종모형으로 선택했습니다.

#31 최종모형 선택
최종모형은 평균세대수, 개별세대수, 문화시설수가 빠진 12개의 독립변수를 가진 모형입니다.
추정회귀계수는 개발호재가 18.8459로 가장 높았고 노후도가 -1.9706으로 가장 낮았습니다.
앞서 의사결정학습법하고는 전혀 다르게 나타났습니다.
개발호재, 역세권점수, 스타벅스 등 외부변수가 집값 형성에 많은 영향을 주는 것을 확인할 수 있고,
의외인 것은 평균인구수가 높다고 집값이 많이 상승하지 않는다는 점과 평균혼인건수와 쇼핑시설수의 추정계수가
음수라는 점입니다. 

#32 결론 모형평가
두 모형을 평가하자면
종속변수에 영향을 주는 독립변수의 차이점을 파악할 수 있었습니다.
의사결정학습법의 경우, 아파트 내부변수인 평균전세가가 가장 영향을 줬다면
회귀모형에서는 개발호재, 역세권점수 등 외부변수가 집값 추정에 많은 영향을 줬습니다.
이러한 모형 평가와 분석을 통해 결론을 내린다면

#33 결론 - 기대효과
기대효과로는 의미 있는 변수들을 통해 인천아파트 매매가격을 분석할 수 있고 완벽하지는 않지만
어느정도 예측가능하지 않을 까라는 생각을 가지게 되었습니다.

#34 결론 - 한계점
다음은 한계점입니다.
분석 하기 전 한계로는 대표적으로 집값에 영향을 주는 많은 변수를 고려할 수 없었다는 점입니다.
아파트 층, 방향, 구조등 세부 변수들이 집값에 영향을 줄 수 있고, 여러 경제적인 측면만 고려해도 다양한 변수가 존재하기 때문입니다.

분석 후 한계점은 모델링 관련 한계점입니다.
의사결정트리의 경우, 계속감소하는 오분률에 대해 어느 수준이 적정인지와
회귀분석의 경우 송도의 집값으로 인한 아웃라이어 변수 해석과 핸들링이 있었고
송도와 같은 특정 신도시의 높은 집값에 대한 해석이 있었습니다.

#35 Thank you
이렇게 해서 7조 발표를 마칩니다. 질문 있으시면 해주시면 감사하겠습니다.